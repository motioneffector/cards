<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>@motioneffector/cards - Demo</title>
  <link rel="stylesheet" href="demo-files/demo.css">
</head>
<body>
  <div class="page">
    <header class="header">
      <h1 class="header-title">@motioneffector/cards</h1>
      <p class="header-description">Character Card V3 and Lorebook parser for TypeScript</p>
      <nav class="header-links">
        <a href="https://www.npmjs.com/package/@motioneffector/cards" class="header-link" target="_blank">ðŸ“¦ npm</a>
        <a href="https://github.com/motioneffector/cards" class="header-link" target="_blank">ðŸ’» GitHub</a>
        <a href="manual/index.html" class="header-link">ðŸ“– Manual</a>
      </nav>
    </header>

    <main>
      <!-- Test Runner (FIRST) -->
      <section class="test-runner" id="test-runner">
        <div class="test-runner-header">
          <h2 class="test-runner-title">Test Runner</h2>
        </div>
        <div class="test-runner-content">
          <!-- Control bar: progress bar + buttons, above output console -->
          <div class="test-control-bar">
            <div class="test-progress">
              <div class="test-progress-bar">
                <div class="test-progress-fill" id="progress-fill"></div>
              </div>
              <div class="test-progress-text" id="progress-text">Ready</div>
            </div>
            <div class="test-runner-actions">
              <button class="btn btn-primary" id="run-all-tests">
                <span class="btn-icon">â–¶</span>
                <span>Run All Tests</span>
              </button>
              <button class="btn btn-secondary" id="reset-page">
                <span class="btn-icon">â†»</span>
                <span>Reset Page</span>
              </button>
            </div>
          </div>
          <!-- Output console below the control bar -->
          <div class="test-output" id="test-output">
            <div class="test-output-placeholder">Click "Run All Tests" to execute the test suite and see a live demonstration</div>
          </div>
          <div class="test-summary hidden" id="test-summary"></div>
        </div>
      </section>

      <!-- Exhibit 1: PNG Anatomy Theater -->
      <section class="exhibit" id="exhibit-1">
        <div class="exhibit-header">
          <h2 class="exhibit-title">PNG Anatomy Theater</h2>
          <p class="exhibit-description">See what's actually inside a character card PNG - the invisible made visible</p>
        </div>
        <div class="exhibit-content">
          <div class="exhibit-interactive">
            <div class="three-panel">
              <div class="panel">
                <div class="panel-header">PNG Chunks</div>
                <div class="panel-content">
                  <div class="chunk-list" id="chunk-list">
                    <!-- Populated by JS -->
                  </div>
                </div>
              </div>
              <div class="panel">
                <div class="panel-header">Base64 Decode</div>
                <div class="panel-content">
                  <div class="decode-stream" id="decode-stream">
                    <!-- Animated decode view -->
                  </div>
                </div>
              </div>
              <div class="panel">
                <div class="panel-header">Card Data</div>
                <div class="panel-content">
                  <div class="card-fields" id="card-fields">
                    <!-- Parsed card fields -->
                  </div>
                  <div class="normalization-banner hidden" id="norm-banner">
                    <!-- Normalization info -->
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="exhibit-controls">
            <button class="btn btn-primary" id="replay-parse">Replay Parse</button>
            <button class="btn btn-secondary" id="load-v1">Load V1 Sample</button>
            <button class="btn btn-secondary" id="load-v2">Load V2 Sample</button>
            <button class="btn btn-secondary" id="load-v3">Load V3 Sample</button>
            <div class="speed-slider">
              <span class="speed-label">Speed:</span>
              <input type="range" min="0" max="100" value="70" id="parse-speed">
              <span class="speed-label" id="speed-text">Fast</span>
            </div>
          </div>
          <div class="exhibit-state">
            <div class="exhibit-state-title">Parse State</div>
            <div id="parse-state">Ready - Click a sample or drop your own PNG</div>
          </div>
          <div class="drop-zone" id="drop-zone-1">
            Or drop your own PNG/JSON/CHARX file here
          </div>
        </div>
      </section>

      <!-- Exhibit 2: Format Forge -->
      <section class="exhibit" id="exhibit-2">
        <div class="exhibit-header">
          <h2 class="exhibit-title">Format Forge</h2>
          <p class="exhibit-description">Write cards to PNG/JSON/CHARX - watch the embedding process happen</p>
        </div>
        <div class="exhibit-content">
          <div class="exhibit-interactive">
            <div class="two-panel">
              <div class="panel">
                <div class="panel-header">Card Data</div>
                <div class="panel-content">
                  <div class="form-group">
                    <label class="form-label">Name</label>
                    <input type="text" class="form-input" id="forge-name" value="Elena">
                  </div>
                  <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-input" id="forge-desc">A traveling merchant who deals in rare magical artifacts. She runs a modest cart between villages.</textarea>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Personality</label>
                    <textarea class="form-input" id="forge-personality">Shrewd but fair. Values honesty in business dealings. Has a dry wit.</textarea>
                  </div>
                  <div class="form-group">
                    <label class="form-label">First Message</label>
                    <textarea class="form-input" id="forge-first-mes">*Elena looks up from arranging her wares, a knowing smile crossing her weathered face.* Ah, a customer with discerning taste, I hope. Looking for something specific, or shall I surprise you?</textarea>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Tags (comma-separated)</label>
                    <input type="text" class="form-input" id="forge-tags" value="fantasy, merchant, original, friendly">
                  </div>
                </div>
              </div>
              <div class="panel">
                <div class="panel-header">Output Workbench</div>
                <div class="panel-content">
                  <div class="mb-md">
                    <span class="text-secondary">Format:</span>
                    <span class="tag tag-blue" id="output-format-label">PNG</span>
                  </div>
                  <div class="output-chunks" id="output-chunks">
                    <!-- Populated by JS -->
                  </div>
                  <div class="mt-md text-secondary" id="output-info">
                    <!-- Size and status info -->
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="exhibit-controls">
            <select class="input" id="output-format">
              <option value="png" selected>PNG</option>
              <option value="json">JSON</option>
              <option value="charx">CHARX</option>
            </select>
            <label class="toggle">
              <input type="checkbox" id="include-v2" checked>
              <span class="toggle-switch"></span>
              <span class="toggle-label">Include V2 Chunk</span>
            </label>
            <label class="toggle">
              <input type="checkbox" id="serialize-decorators" checked>
              <span class="toggle-switch"></span>
              <span class="toggle-label">Serialize Decorators</span>
            </label>
            <button class="btn btn-primary" id="build-download">Build & Download</button>
            <button class="btn btn-secondary" id="reset-forge">Reset to Example</button>
          </div>
          <div class="exhibit-state">
            <div class="exhibit-state-title">Build State</div>
            <div id="forge-state">Ready - Edit fields and watch output update</div>
          </div>
        </div>
      </section>

      <!-- Exhibit 3: Decorator Transformer -->
      <section class="exhibit" id="exhibit-3">
        <div class="exhibit-header">
          <h2 class="exhibit-title">Decorator Transformer</h2>
          <p class="exhibit-description">Watch @@decorator syntax transform to structured data and back</p>
        </div>
        <div class="exhibit-content">
          <div class="exhibit-interactive">
            <div class="decorator-split">
              <div class="decorator-panel">
                <div class="decorator-panel-header">
                  <span class="decorator-panel-title">Raw Text</span>
                  <button class="btn btn-small btn-primary" id="parse-decorators">Parse</button>
                </div>
                <div class="decorator-panel-content">
                  <textarea class="raw-content" id="raw-decorators">@@depth 4
@@role system
@@activate_only_after 3
The Crystal Tower is an ancient spire built by the First Mages. Its walls shimmer with preserved enchantments, and the library within contains scrolls dating back millennia.</textarea>
                </div>
              </div>
              <div class="decorator-panel">
                <div class="decorator-panel-header">
                  <span class="decorator-panel-title">Structured</span>
                  <button class="btn btn-small btn-primary" id="serialize-btn">Serialize</button>
                </div>
                <div class="decorator-panel-content">
                  <div class="structured-content">
                    <div class="decorators-area" id="decorators-area">
                      <!-- Decorator chips appear here -->
                    </div>
                    <div class="content-preview" id="content-preview">
                      <!-- Clean content preview -->
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="lorebook-entries" id="lorebook-entries">
              <div class="text-secondary mb-sm">Lorebook Entries (click to load)</div>
              <!-- Entry items -->
            </div>
          </div>
          <div class="exhibit-controls">
            <span class="text-secondary">Add decorator:</span>
            <button class="btn btn-small btn-secondary" data-decorator="depth">+ depth</button>
            <button class="btn btn-small btn-secondary" data-decorator="role">+ role</button>
            <button class="btn btn-small btn-secondary" data-decorator="position">+ position</button>
            <button class="btn btn-small btn-secondary" data-decorator="activate">+ activate</button>
            <button class="btn btn-small btn-secondary" data-decorator="scan_depth">+ scan_depth</button>
          </div>
          <div class="exhibit-state">
            <div class="exhibit-state-title">Transform State</div>
            <div id="decorator-state">Synced - Both sides match</div>
          </div>
        </div>
      </section>

      <!-- Exhibit 4: Repair Laboratory -->
      <section class="exhibit" id="exhibit-4">
        <div class="exhibit-header">
          <h2 class="exhibit-title">Repair Laboratory</h2>
          <p class="exhibit-description">Watch recovery strategies probe corrupted data in real-time</p>
        </div>
        <div class="exhibit-content">
          <div class="exhibit-interactive">
            <div class="two-panel">
              <div class="panel">
                <div class="panel-header">Strategy Log</div>
                <div class="panel-content">
                  <div class="repair-log" id="repair-log">
                    <!-- Repair entries -->
                  </div>
                </div>
              </div>
              <div class="panel">
                <div class="panel-header">Recovered Data</div>
                <div class="panel-content">
                  <div class="recovered-fields" id="recovered-fields">
                    <!-- Recovered field status -->
                  </div>
                  <div class="mt-md" id="recovery-summary">
                    <!-- Summary stats -->
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="exhibit-controls">
            <button class="btn btn-primary" id="replay-repair">Replay</button>
            <button class="btn btn-secondary" id="load-bad-crc">Bad CRC Sample</button>
            <button class="btn btn-secondary" id="load-truncated">Truncated Base64</button>
            <button class="btn btn-secondary" id="load-malformed">Malformed JSON</button>
            <button class="btn btn-success" id="load-healthy">Try Healthy Card</button>
            <div class="speed-slider">
              <span class="speed-label">Speed:</span>
              <input type="range" min="0" max="100" value="50" id="repair-speed">
            </div>
          </div>
          <div class="exhibit-state">
            <div class="exhibit-state-title">Repair State</div>
            <div id="repair-state">Ready - Click a scenario to test repair</div>
          </div>
          <div class="drop-zone" id="drop-zone-4">
            Or drop your own file to test repair
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Library (from dist or CDN) -->
  <script type="module">
    import * as Library from './dist/index.js'
    window.Library = Library
  </script>

  <!-- Demo scripts (order matters) -->
  <script src="demo-files/test-runner.js"></script>
  <script type="module" src="demo-files/demo.js"></script>
  <script type="module" src="demo-files/tests.js"></script>
</body>
</html>
